!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ssoIframe=e():t.ssoIframe=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";var o={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,n,r,i,a,c,d,f="",s=0;for(t=o._utf8_encode(t);s<t.length;)i=(e=t.charCodeAt(s++))>>2,a=(3&e)<<4|(n=t.charCodeAt(s++))>>4,c=(15&n)<<2|(r=t.charCodeAt(s++))>>6,d=63&r,isNaN(n)?c=d=64:isNaN(r)&&(d=64),f=f+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(c)+this._keyStr.charAt(d);return f},decode:function(t){var e,n,r,i,a,c,d="",f=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");f<t.length;)e=this._keyStr.indexOf(t.charAt(f++))<<2|(i=this._keyStr.indexOf(t.charAt(f++)))>>4,n=(15&i)<<4|(a=this._keyStr.indexOf(t.charAt(f++)))>>2,r=(3&a)<<6|(c=this._keyStr.indexOf(t.charAt(f++))),d+=String.fromCharCode(e),64!=a&&(d+=String.fromCharCode(n)),64!=c&&(d+=String.fromCharCode(r));return d=o._utf8_decode(d)},_utf8_encode:function(t){t=t.replace(/rn/g,"n");for(var e="",n=0;n<t.length;n++){var o=t.charCodeAt(n);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e},_utf8_decode:function(t){for(var e="",n=0,o=c1=c2=0;n<t.length;)(o=t.charCodeAt(n))<128?(e+=String.fromCharCode(o),n++):o>191&&o<224?(c2=t.charCodeAt(n+1),e+=String.fromCharCode((31&o)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),e+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),n+=3);return e}};t.exports={getOrigin:function(){return window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),window.location.origin},getGetParam:function(t){var e=String(window.location.href).split("?")[1];if(null==e)return"";for(var n=e.split("&"),o=0,r=n.length;o<r;o++)if(0==n[o].indexOf(t))return decodeURI(n[o].split("=")[1])},JWT:function(t){function e(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=t.replace(/-/g,"+"),t=t.replace(/_/g,"/")}this.header=function(){var n=e(t.substring(0,t.indexOf("."))),r=o.decode(n);return JSON.parse(r)},this.payload=function(){var n=e(t.substring(t.indexOf(".")+1,t.lastIndexOf("."))),r=o.decode(n);return JSON.parse(r)},this.isExpired=function(){var t=this.payload();return!t.exp||t.exp<=Date.now()/1e3}},Base64:o}},function(t,e,n){"use strict";function o(t){a(t,w="*")}function r(){a({action:"sso.onlogout"},w="*")}function i(){a({action:"sso.onload"},w="*")}function a(t,e){window.attachEvent?window.parent.postMessage(JSON.stringify(t),e):window.parent.postMessage(t,e)}function c(t){localStorage.setItem(m,t)}function d(t){var e=localStorage.getItem(m);e?u(e):r()}function f(t){setTimeout(function(){var t=localStorage.getItem(m);t?u(t):r()},1)}function s(t){var e=t.data;if(e.hasOwnProperty("action")){var n=e.action;"logout"==n?(localStorage.removeItem(m),r()):"login"==n&&e.hasOwnProperty("jwt")&&c(e.jwt)}}function u(t){h&&p?function(t){new S.JWT(t);new y.RestClient(p,g,v).validateJWT(t,function(e){var n=e;e.AuthenticationOperation&&(n=e.AuthenticationOperation),"SUCCESS"==n.status?(n.jwt&&n.jwt!=t?c(n.jwt):n.jwt=t,n.action="sso.onidentification",o(n)):localStorage.removeItem(m),i()})}(t):function(t){try{var e=new S.JWT(t),n=e.payload();if(e.isExpired())throw"JWT expired";n.status="UNKNOWN",n.action="sso.onidentification",n.jwt=t,o(n)}catch(t){localStorage.removeItem(m)}i()}(t)}function l(){var t=localStorage.getItem(m);t?u(t):i()}var p,h,g,m,v,w,S=n(0),y=n(2);t.exports={init:function(){g=(0,S.getGetParam)("accountId"),w=(0,S.getGetParam)("domain"),p=(0,S.getGetParam)("validationUrl"),(h=!("false"==(0,S.getGetParam)("validate")))&&!p&&(p=(0,S.getOrigin)()+"/validate");var t={validationUrl:p,accountId:g,apiKey:"",domain:w,tokenId:"ssls.sso.jwt."+g,validate:h};window.addEventListener?window.addEventListener("storage",d,!1):document.attachEvent("onstorage",f),window.addEventListener?addEventListener("message",s,!1):attachEvent("onmessage",s),window.addEventListener?window.addEventListener("load",l,!1):window.attachEvent&&window.attachEvent("onload",l),p=t.validationUrl,h=t.validate,g=t.accountId,m=t.tokenId,v=t.apiKey},onIdentification:o}},function(t,e,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n(0);t.exports={RestClient:function(t,e,n,r){function i(t){if(t){var e=t;return"object"===(void 0===t?"undefined":o(t))&&(e=JSON.stringify(t,null,4)),JSON.parse(e)}}r=function(t){if(t||(t="Basic"),"Basic"!=t&&"JWT"!=t&&"CJWT"!=t)throw"Scheme "+t+"not valid";return t}(r),this.validateJWT=function(e,n,o){return function(t,e,n,o){var r=null;e&&(r=JSON.stringify(e,null,4)),$.support.cors=!0,$.ajax({type:"POST",url:t,data:r,contentType:"application/json; charset=utf-8",crossdomain:!0,beforeSend:function(t){t.setRequestHeader("Authorization",function(t){return"Bearer "+t}(e.jwt))}}).done(function(t){t=i(t),n(t)}).fail(function(t){o(t)})}(t,{jwt:e},n,o)};var a={};a.x=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t,e=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],n=0;n<e.length;n++)try{t=new ActiveXObject(e[n]);break}catch(t){}return t},a.send=function(t,e,n,o,r){void 0===r&&(r=!0);var i=a.x();i.open(n,t,r),i.onreadystatechange=function(){4==i.readyState&&e(i.responseText)},"POST"==n&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o)},a.get=function(t,e,n,o){var r=[];for(var i in e)r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));a.send(t+(r.length?"?"+r.join("&"):""),n,"GET",null,o)},a.post=function(t,e,n,o){var r=[];for(var i in e)r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));a.send(t,n,"POST",r.join("&"),o)}}}}])});